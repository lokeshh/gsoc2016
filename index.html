
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GSoC 2016 Progress</title>
  <meta name="author" content="Lokesh Sharma">

  
  <meta name="description" content="After the end of 6 weeks we have category data support in Daru. Now in the coming weeks we will be adding support for category data in Statsample and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lokeshh.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="GSoC 2016 Progress" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">GSoC 2016 Progress</a></h1>
  
    <h2>Categorical Data Support [SciRuby]</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lokeshh.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/19/formula-language-week7-8/">Formula Language Implementation [Week 7-8]</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-19T18:26:41+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After the end of 6 weeks we have category data support in Daru. Now in the coming weeks we will be adding support for category data in Statsample and Statsample-GLM.</p>

<p>Currently, Statsample and Statsample-GLM do not support regression with category data.</p>

<p>With the introduction of formula language I am looking to accomplish the following:</p>

<ul>
<li>To support regression with category data</li>
<li>To provide convenience of formula language to create regression models</li>
</ul>


<p>In these two weeks I have implemented a formula language but it is limited in certain ways. The work of following weeks will fill this gap.</p>

<p>Lets talk about the formula language I have implemented in these two weeks.</p>

<h2>Formula Language</h2>

<p>The formula language which I aim to implement is similar to that used within <a href="https://patsy.readthedocs.io/en/stable/formulas.html#how-formulas-work">R and Patsy</a></p>

<p>With the work of these two weeks, the formula language has the following features:</p>

<ul>
<li>It supports 2-way interaction.</li>
<li>It supports <code>:</code> and <code>+</code>.</li>
<li>It supports inclusion/exclusion of contant or intercept term.</li>
</ul>


<p>And since I have followed the Patsy way of implementing the formula langauge it has an edge over R. Since, Patsy has a more accurate algorithm for deciding whether to use a full- or reduced-rank coding scheme for categorical factors, the same is inherited in Statsample and Statsample-GLM.</p>

<p>R sometimes can give under-specified model but this is not the case with our implementation. One example is expansion of <code>0 + a:x + a:b</code>, where <code>x</code> is numeric. More information about this can be found <a href="https://patsy.readthedocs.io/en/stable/R-comparison.html">here</a>.</p>

<p>I am thankful to Patsy for it made my work very easy by providing all the details in their <a href="https://patsy.readthedocs.io/en/stable/formulas.html#how-formulas-work">documentation</a>. Without it I would have fallen into many pitfalls.</p>

<p>Now lets see formula language in action in Statsample and Statsample-GLM.</p>

<h2>Regression in Statsample-GLM</h2>

<p>Regression in Statsample-GLM has become an easy task and in addition it now supports category data as predictor variables.</p>

<p>Lets see this by an example.</p>

<p>Lets assume a dataframe <code>df</code> with numeric columns <code>a</code>, <code>b</code>, and having category column <code>c</code>, <code>d</code>, <code>e</code>.</p>

<p>Lets create a logistic model with predictors <code>a</code>, <code>a*b</code>, <code>c</code> and <code>c:d</code>.</p>

<p>If we were to do this earlier, we would have done the following.</p>

<p>Since we can&rsquo;t code category variables, so lets leave <code>c</code> and <code>c:d</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">train</span><span class="o">[</span><span class="s1">&#39;a:b&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">]</span> <span class="o">*</span> <span class="n">train</span><span class="o">[</span><span class="s1">&#39;b&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a:b&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">mod</span> <span class="o">=</span> <span class="no">Statsample</span><span class="o">::</span><span class="no">GLM</span><span class="o">.</span><span class="n">compute</span> <span class="n">train</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="ss">:logistic</span><span class="p">,</span> <span class="ss">constant</span><span class="p">:</span> <span class="mi">1</span>
</span><span class='line'><span class="o">&gt;</span> <span class="c1"># Now lets obtain predictions</span>
</span><span class='line'><span class="o">&gt;</span> <span class="nb">test</span><span class="o">[</span><span class="s1">&#39;a:b&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="nb">test</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">]</span> <span class="o">*</span> <span class="nb">test</span><span class="o">[</span><span class="s1">&#39;b&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="nb">test</span> <span class="o">=</span> <span class="nb">test</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a:b&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">mod</span><span class="o">.</span><span class="n">predict</span> <span class="nb">test</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::Vector(3)&gt;</span>
</span><span class='line'>      <span class="mi">0</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9999</span>
</span><span class='line'>      <span class="mi">1</span> <span class="mi">0</span><span class="o">.</span><span class="mo">0123</span>
</span><span class='line'>      <span class="mi">2</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5925</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now with the introduction of formula langauge it has become a very easy task with no work required to preprocess the dataframe.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">reg</span> <span class="o">=</span> <span class="no">Statsample</span><span class="o">::</span><span class="no">GLM</span><span class="o">::</span><span class="no">Regression</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;y~a+a:b+c+c:d&#39;</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="ss">:logistic</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span> <span class="nb">test</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::Vector(3)&gt;</span>
</span><span class='line'>      <span class="mi">0</span> <span class="mi">0</span><span class="o">.</span><span class="mi">2999</span>
</span><span class='line'>      <span class="mi">1</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1523</span>
</span><span class='line'>      <span class="mi">2</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8925</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above code not only enables predictions with caetgory data but also reflects the powerful formula langauge.</p>

<p><a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/%5BExample%5D%20Formula%20language%20in%20Statsample-GLM.ipynb">Here&rsquo;s</a> a notebook that describes the use of formula language in Statsample-GLM using real life data.</p>

<p>Lets have a look at Statsample now.</p>

<h2>Statsample</h2>

<p>With Statsample, its the same. Now one can perform multiple regression with formula language and category variables as predictors.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">reg</span> <span class="o">=</span> <span class="no">Statsample</span><span class="o">::</span><span class="no">FitModel</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;y~a+a:b+c+c:d&#39;</span><span class="p">,</span> <span class="n">train</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">model</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will give a multiple linear regression model.</p>

<h2>Conclusion</h2>

<p>The introduction of formula language and ability to handle category data has given a great boost to Data Analysis in Ruby and I really hope we keep improving it further and further.</p>

<p>In the coming weeks I will look forward to implement the following:</p>

<ul>
<li>Add more than 2-way interaction support</li>
<li>Support for shortcut symbols &lsquo;*&rsquo;, &lsquo;/&rsquo;, etc.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/02/visualization/">Visualization [Week 5-6]</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-02T15:48:03+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>3:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>During these two weeks I added visualization of categorical data in addition to support of a new plotting library <a href="https://github.com/topfunky/gruff">Gruff</a></p>

<p>Daru supports visualization via three libraries:</p>

<ul>
<li><a href="https://github.com/SciRuby/nyaplot">Nyaplot</a></li>
<li><a href="https://github.com/SciRuby/gnuplotrb/">GnuplotRB</a></li>
<li><a href="https://github.com/topfunky/gruff">Gruff</a> (new)</li>
</ul>


<p>Lets discuss them one by one</p>

<h2>Nyaplot</h2>

<p>Nyaplot is the default plotting library for Daru. Nyaplot allows creation of a variety of plots with Daru easily. Its biggest strength lies in its ablity to draw interactive plots.</p>

<p>Now Daru also supports categorical data visualization using Nyaplot. It mainly has two aspects:</p>

<ul>
<li>In case of a category vector it allows to view the frequencies of categories in a bar graph.</li>
<li>And in case of dataframe containing a category vector, it allows to have scatter and line plots categorized by a category vector visualized by different shape, size and color.</li>
</ul>


<p><a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/Visualization.ipynb">Here</a> are some examples of visualization of category data using Nyaplot in Daru.</p>

<h2>GnuplotRB</h2>

<p>GnuplotRB is another great library which has inbuilt support for Daru datastructres: <code>Daru::Vector</code> and <code>Daru::DataFrame</code>. Though it doesn&rsquo;t directly operate on vectors and dataframes but uses its own API.</p>

<p>GnuplotRB strength lies in its offering of highly customized plots with yet a very simple to use API.</p>

<p>No work was done regarding supporting categorical data visualization in GnuplotRB because it supports it out of the box owing to its easy to API that lets plot multiple plots with a variety of features.</p>

<p><a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/Gnuplotrb.ipynb">Here&rsquo;s</a> a notebook demonstrating examples in the manner category data can be visualizaed using GnuplotRB.</p>

<h2>Gruff</h2>

<p>Gruff is a new plotting library that has just been added to Daru. <a href="https://github.com/topfunky/gruff">Gruff</a> offers remarkably beautiful plots with very less effort. It also offers pie and sidebar plots which currently the other two libraries don&rsquo;t offer.</p>

<p>These two notebooks show examples related to plotting of <code>Daru::Vector</code> and <code>Daru::DataFrame</code>:</p>

<ul>
<li><a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/Gruff%20Vector.ipynb">Plotting of Vector</a></li>
<li><a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/Gruff%20DataFrame.ipynb">Plotting of DataFrame</a></li>
</ul>


<h2>Choose from different libraries</h2>

<p>To easily move between these all these libraries, Daru has following functions:</p>

<ul>
<li><code>Daru.plotting_library</code></li>
<li><code>Daru::Vector#plotting_library</code></li>
<li><code>Daru::DataFrame#plotting_library</code></li>
</ul>


<p><code>Daru.plotting_library</code> can be used to set the current plotting library. For example, using <code>Daru.plotting_library = :gruff</code> one can switch the plotting library to Gruff. This means all the plots created here after will be using Gruff for plotting.</p>

<p>Inorder to change plotting library for only a specific vector, one can use <code>Daru::Vector#plotting_library</code>. For example, <code>dv.plotting_library = :gruff</code> will only change plotting library for vector <code>dv</code> and all other vector created will created using the library as set by <code>Daru.plotting_library</code>.</p>

<p>The same goes for dataframes, one can use <code>df.plotting_library = :gruff</code> to set plotting library for data frame <code>df</code> to Gruff.</p>

<h2>Summary</h2>

<p>Along with the support of categorical data, Daru now also owns the ability to visualize catgory data. I realized and addressed a few shortcoming of some of these libraries and we at SciRuby are motivated to overcome those shortcoming and make visualization in Daru more complete.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/21/categorical-data/">Categorical Data [Week 3-4]</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-21T20:19:08+00:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>8:19 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Daru has now the capability to store and process categorical data.</p>

<p>Daru has now three types of vector</p>

<ul>
<li>:object</li>
<li>:numeric</li>
<li>:category (new)</li>
</ul>


<p>With introduction of categorical data, Daru has now two benefits-</p>

<ol>
<li>Storage of categorical data is very effective.</li>
<li>Tasks related to categorical data have become a lot easier</li>
</ol>


<p>The reason for <code>1</code> is that in ordinary vector the data is stored as an array.
It doesn&rsquo;t consider the fact that most of the entries are same.</p>

<p>Lets discuss the various tasks which can now be done easily related to categorical vector.</p>

<p>(The purpose of this blog is to give an overview of what tasks can be accomplished with categorical data. To learn about what each method do and how to use it please look at <a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/Categorical%20Data.ipynb">this notebook</a>)</p>

<p>As soon as one declares a categorical variable, one can look at frequency count of each category to get judgement of the data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">rank</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="s1">&#39;III&#39;</span><span class="o">]*</span><span class="mi">10</span> <span class="o">+</span> <span class="o">[</span><span class="s1">&#39;II&#39;</span><span class="o">]*</span><span class="mi">5</span> <span class="o">+</span> <span class="o">[</span><span class="s1">&#39;I&#39;</span><span class="o">]*</span><span class="mi">5</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:category</span><span class="p">,</span> <span class="ss">categories</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;II&#39;</span><span class="p">,</span> <span class="s1">&#39;III&#39;</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">rank</span><span class="o">.</span><span class="n">frequencies</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::Vector(3)&gt;</span>
</span><span class='line'>   <span class="n">I</span>   <span class="mi">5</span>
</span><span class='line'>  <span class="no">II</span>   <span class="mi">5</span>
</span><span class='line'> <span class="no">III</span>  <span class="mi">10</span>
</span></code></pre></td></tr></table></div></figure>


<p>One can look over the summary of the data to get to know common numbers about categorical data like how many categories are present, which is the most frequenct category, etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">rank</span><span class="o">.</span><span class="n">summary</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::Vector(6)&gt;</span>
</span><span class='line'>         <span class="n">size</span>           <span class="mi">20</span>
</span><span class='line'>   <span class="n">categories</span>            <span class="mi">3</span>
</span><span class='line'>     <span class="n">max_freq</span>           <span class="mi">10</span>
</span><span class='line'> <span class="n">max_category</span>          <span class="no">III</span>
</span><span class='line'>     <span class="n">min_freq</span>            <span class="mi">5</span>
</span><span class='line'> <span class="n">min_category</span>            <span class="n">I</span>
</span></code></pre></td></tr></table></div></figure>


<p>Its possible to convert a numerical variable into categorical variable. For example <code>heights</code> store measures of heights and we want to categorize them into categories <code>low</code>, <code>medium</code> and <code>high</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">heights</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">51</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">heights</span><span class="o">.</span><span class="n">cut</span> <span class="o">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">height_cat</span> <span class="o">=</span> <span class="n">heights</span><span class="o">.</span><span class="n">cut</span> <span class="o">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="o">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">height_cat</span><span class="o">.</span><span class="n">rename_categories</span> <span class="s1">&#39;30-39&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;40-49&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;50-59&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;high&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">height_cat</span><span class="o">.</span><span class="n">frequencies</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::Vector(3)&gt;</span>
</span><span class='line'>    <span class="n">low</span>      <span class="mi">3</span>
</span><span class='line'> <span class="n">medium</span>      <span class="mi">1</span>
</span><span class='line'>   <span class="n">high</span>      <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given a dataframe its possible to extract rows based on the categories. It uses the same Area-like query syntax like an ordinary vector. For example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span class='line'>  <span class="nb">id</span><span class="p">:</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">grade</span><span class="p">:</span> <span class="sx">%w[A C B A C C B B]</span><span class="p">,</span>
</span><span class='line'>  <span class="nb">name</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="o">]</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">[</span><span class="ss">:grade</span><span class="o">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">[</span><span class="ss">:grade</span><span class="o">].</span><span class="n">to_category</span> <span class="ss">ordered</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">categories</span><span class="p">:</span> <span class="sx">%w[A B C]</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span> <span class="n">df</span><span class="o">[</span><span class="ss">:grade</span><span class="o">].</span><span class="n">lt</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::DataFrame(5x3)&gt;</span>
</span><span class='line'>       <span class="n">grade</span>    <span class="nb">id</span>  <span class="nb">name</span>
</span><span class='line'>     <span class="mi">0</span>     <span class="n">A</span>     <span class="mi">0</span>     <span class="n">a</span>
</span><span class='line'>     <span class="mi">2</span>     <span class="n">B</span>     <span class="mi">2</span>     <span class="n">c</span>
</span><span class='line'>     <span class="mi">3</span>     <span class="n">A</span>     <span class="mi">3</span>     <span class="n">d</span>
</span><span class='line'>     <span class="mi">6</span>     <span class="n">B</span>     <span class="mi">6</span>     <span class="n">g</span>
</span><span class='line'>     <span class="mi">7</span>     <span class="n">B</span>     <span class="mi">7</span>     <span class="n">h</span>
</span></code></pre></td></tr></table></div></figure>


<p>The benefit is that we used <code>lt</code> based on the order we set.</p>

<p>By defining the custom order of categories and setting <code>ordered</code> to <code>true</code>, one can sort the categories, find the min, max, etc. For example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Assuming df defined as above</span>
</span><span class='line'><span class="c1"># Lets rename the categories to show that lexical order is not followed while sorting with categorical data</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">[</span><span class="ss">:grade</span><span class="o">].</span><span class="n">rename_categories</span> <span class="s1">&#39;A&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Average&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bad&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">df</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::DataFrame(8x3)&gt;</span>
</span><span class='line'>           <span class="n">grade</span>      <span class="nb">id</span>    <span class="nb">name</span>
</span><span class='line'>       <span class="mi">0</span>    <span class="no">Good</span>       <span class="mi">0</span>       <span class="n">a</span>
</span><span class='line'>       <span class="mi">1</span>     <span class="no">Bad</span>       <span class="mi">1</span>       <span class="n">b</span>
</span><span class='line'>       <span class="mi">2</span> <span class="no">Average</span>       <span class="mi">2</span>       <span class="n">c</span>
</span><span class='line'>       <span class="mi">3</span>    <span class="no">Good</span>       <span class="mi">3</span>       <span class="n">d</span>
</span><span class='line'>       <span class="mi">4</span>     <span class="no">Bad</span>       <span class="mi">4</span>       <span class="n">e</span>
</span><span class='line'>       <span class="mi">5</span>     <span class="no">Bad</span>       <span class="mi">5</span>       <span class="n">f</span>
</span><span class='line'>       <span class="mi">6</span> <span class="no">Average</span>       <span class="mi">6</span>       <span class="n">g</span>
</span><span class='line'>       <span class="mi">7</span> <span class="no">Average</span>       <span class="mi">7</span>       <span class="n">h</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">sort!</span> <span class="o">[</span><span class="ss">:grade</span><span class="o">]</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Daru::DataFrame(8x3)&gt;</span>
</span><span class='line'>           <span class="n">grade</span>      <span class="nb">id</span>    <span class="nb">name</span>
</span><span class='line'>       <span class="mi">0</span>    <span class="no">Good</span>       <span class="mi">0</span>       <span class="n">a</span>
</span><span class='line'>       <span class="mi">3</span>    <span class="no">Good</span>       <span class="mi">3</span>       <span class="n">d</span>
</span><span class='line'>       <span class="mi">2</span> <span class="no">Average</span>       <span class="mi">2</span>       <span class="n">c</span>
</span><span class='line'>       <span class="mi">6</span> <span class="no">Average</span>       <span class="mi">6</span>       <span class="n">g</span>
</span><span class='line'>       <span class="mi">7</span> <span class="no">Average</span>       <span class="mi">7</span>       <span class="n">h</span>
</span><span class='line'>       <span class="mi">1</span>     <span class="no">Bad</span>       <span class="mi">1</span>       <span class="n">b</span>
</span><span class='line'>       <span class="mi">4</span>     <span class="no">Bad</span>       <span class="mi">4</span>       <span class="n">e</span>
</span><span class='line'>       <span class="mi">5</span>     <span class="no">Bad</span>       <span class="mi">5</span>       <span class="n">f</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Example</h2>

<p>Please have a look at <a href="http://nbviewer.jupyter.org/github/lokeshh/cat_notebook/blob/master/%5BExample%5D%20Categorical%20Data.ipynb">this notebook</a> which describes use of categorical data though an example.</p>

<h2>Internal Structure</h2>

<p>Its similar to the internal structure of categorical index.</p>

<p>To efficiently store the duplicates of catgories and make retrieval possible in constant time, categorical data in Daru uses two data structres-</p>

<ul>
<li>Hash-table: To map each category to positional values. It is represented as <code>@cat_hash</code>.</li>
<li>Array: To map each position to a integer which represent a category.</li>
</ul>


<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">dv</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:C</span><span class="o">]</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:category</span>
</span></code></pre></td></tr></table></div></figure>


<p>For <code>dv</code>, the hash table and array would be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@cat_hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">c</span><span class="p">:</span> <span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@array</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Of course, we would need to have a variable to map <code>0</code> to <code>:a</code>, <code>1</code> to <code>:b</code> and <code>2</code> to <code>:c</code>.)</p>

<p>The hash table helps us in retriving all instances which belong to that category in real time.</p>

<p>Similary, the array helps us in retriving category of an instance in constant time.</p>

<p>And the reason to store integers in the array instead of name of categories itself is to avoid unnecessary usage of space.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/14/categorical-index/">Categorical Index [Week 1-2]</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-14T07:54:47+00:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:54 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Daru just got a new capability => Categorical Index.</p>

<p>Now one can organize vector and dataframe using index that is categorical.</p>

<p>Daru has got now 4 types of indexes to index data:</p>

<ul>
<li>Daru::Index</li>
<li>Daru::MultiIndex</li>
<li>Daru::DateTimeIndex</li>
<li>Daru::CategoricalIndex (new)</li>
</ul>


<p><code>Daru::Index</code> is for usual index where every value is unique.</p>

<p><code>Daru::MultiIndex</code> is for indexing with more than one level.</p>

<p><code>Daru::DateTimeIndex</code> is to have indexing with dates. Its powerful means to analyze time series data.</p>

<p>The new <code>Daru::CategoricalIndex</code> is helpful with data indexed with sparsely populated index with each unique index value as category.</p>

<p>Please visit <a href="https://github.com/SciRuby/sciruby-notebooks/blob/master/Data%20Analysis/Categorical%20Data/Indexing%20in%20Vector.ipynb">this link</a> before to get a basic understanding of how indexing works in Daru::Vector and <a href="https://github.com/SciRuby/sciruby-notebooks/blob/master/Data%20Analysis/Categorical%20Data/Indexing%20in%20DataFrame.ipynb">this link</a> for Daru::DataFrame.</p>

<h2>Example</h2>

<p>Let&rsquo;s see an example.</p>

<p>(Alternatively you can also see this example in iRuby notebook <a href="https://github.com/SciRuby/sciruby-notebooks/blob/master/Data%20Analysis/Categorical%20Data/examples/%5BExample%5D%20Categorical%20Index.ipynb">here</a>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;daru&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;open-uri&#39;</span>
</span><span class='line'><span class="n">content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;https://d37djvu3ytnwxt.cloudfront.net/asset-v1:MITx+15.071x_3+1T2016+type@asset+block/WHO.csv&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">df</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">from_csv</span> <span class="n">content</span>
</span><span class='line'>
</span><span class='line'><span class="n">df</span><span class="o">.</span><span class="n">vector</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">=&gt;</span> <span class="c1">#&lt;Daru::DataFrame(194x6)&gt;</span>
</span><span class='line'>                 <span class="no">Country</span>     <span class="no">Region</span> <span class="no">Population</span>    <span class="no">Under15</span>     <span class="no">Over60</span> <span class="no">FertilityR</span>
</span><span class='line'>            <span class="mi">0</span> <span class="no">Afghanista</span> <span class="no">Eastern</span> <span class="no">Me</span>      <span class="mi">29825</span>      <span class="mi">47</span><span class="o">.</span><span class="mi">42</span>       <span class="mi">3</span><span class="o">.</span><span class="mi">82</span>        <span class="mi">5</span><span class="o">.</span><span class="mi">4</span>
</span><span class='line'>            <span class="mi">1</span>    <span class="no">Albania</span>     <span class="no">Europe</span>       <span class="mi">3162</span>      <span class="mi">21</span><span class="o">.</span><span class="mi">33</span>      <span class="mi">14</span><span class="o">.</span><span class="mi">93</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">75</span>
</span><span class='line'>            <span class="mi">2</span>    <span class="no">Algeria</span>     <span class="no">Africa</span>      <span class="mi">38482</span>      <span class="mi">27</span><span class="o">.</span><span class="mi">42</span>       <span class="mi">7</span><span class="o">.</span><span class="mi">17</span>       <span class="mi">2</span><span class="o">.</span><span class="mi">83</span>
</span><span class='line'>            <span class="mi">3</span>    <span class="no">Andorra</span>     <span class="no">Europe</span>         <span class="mi">78</span>       <span class="mi">15</span><span class="o">.</span><span class="mi">2</span>      <span class="mi">22</span><span class="o">.</span><span class="mi">86</span>        <span class="kp">nil</span>
</span><span class='line'>            <span class="mi">4</span>     <span class="no">Angola</span>     <span class="no">Africa</span>      <span class="mi">20821</span>      <span class="mi">47</span><span class="o">.</span><span class="mi">58</span>       <span class="mi">3</span><span class="o">.</span><span class="mi">84</span>        <span class="mi">6</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>            <span class="mi">5</span> <span class="no">Antigua</span> <span class="n">an</span>   <span class="no">Americas</span>         <span class="mi">89</span>      <span class="mi">25</span><span class="o">.</span><span class="mi">96</span>      <span class="mi">12</span><span class="o">.</span><span class="mi">35</span>       <span class="mi">2</span><span class="o">.</span><span class="mi">12</span>
</span><span class='line'>            <span class="mi">6</span>  <span class="no">Argentina</span>   <span class="no">Americas</span>      <span class="mi">41087</span>      <span class="mi">24</span><span class="o">.</span><span class="mi">42</span>      <span class="mi">14</span><span class="o">.</span><span class="mi">97</span>        <span class="mi">2</span><span class="o">.</span><span class="mi">2</span>
</span><span class='line'>            <span class="mi">7</span>    <span class="no">Armenia</span>     <span class="no">Europe</span>       <span class="mi">2969</span>      <span class="mi">20</span><span class="o">.</span><span class="mi">34</span>      <span class="mi">14</span><span class="o">.</span><span class="mo">06</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">74</span>
</span><span class='line'>            <span class="mi">8</span>  <span class="no">Australia</span> <span class="no">Western</span> <span class="no">Pa</span>      <span class="mi">23050</span>      <span class="mi">18</span><span class="o">.</span><span class="mi">95</span>      <span class="mi">19</span><span class="o">.</span><span class="mi">46</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">89</span>
</span><span class='line'>            <span class="mi">9</span>    <span class="no">Austria</span>     <span class="no">Europe</span>       <span class="mi">8464</span>      <span class="mi">14</span><span class="o">.</span><span class="mi">51</span>      <span class="mi">23</span><span class="o">.</span><span class="mi">52</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">44</span>
</span><span class='line'>           <span class="mi">10</span> <span class="no">Azerbaijan</span>     <span class="no">Europe</span>       <span class="mi">9309</span>      <span class="mi">22</span><span class="o">.</span><span class="mi">25</span>       <span class="mi">8</span><span class="o">.</span><span class="mi">24</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">96</span>
</span><span class='line'>           <span class="mi">11</span>    <span class="no">Bahamas</span>   <span class="no">Americas</span>        <span class="mi">372</span>      <span class="mi">21</span><span class="o">.</span><span class="mi">62</span>      <span class="mi">11</span><span class="o">.</span><span class="mi">24</span>        <span class="mi">1</span><span class="o">.</span><span class="mi">9</span>
</span><span class='line'>           <span class="mi">12</span>    <span class="no">Bahrain</span> <span class="no">Eastern</span> <span class="no">Me</span>       <span class="mi">1318</span>      <span class="mi">20</span><span class="o">.</span><span class="mi">16</span>       <span class="mi">3</span><span class="o">.</span><span class="mi">38</span>       <span class="mi">2</span><span class="o">.</span><span class="mi">12</span>
</span><span class='line'>           <span class="mi">13</span> <span class="no">Bangladesh</span> <span class="no">South</span><span class="o">-</span><span class="no">East</span>     <span class="mi">155000</span>      <span class="mi">30</span><span class="o">.</span><span class="mi">57</span>       <span class="mi">6</span><span class="o">.</span><span class="mi">89</span>       <span class="mi">2</span><span class="o">.</span><span class="mi">24</span>
</span><span class='line'>           <span class="mi">14</span>   <span class="no">Barbados</span>   <span class="no">Americas</span>        <span class="mi">283</span>      <span class="mi">18</span><span class="o">.</span><span class="mi">99</span>      <span class="mi">15</span><span class="o">.</span><span class="mi">78</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">84</span>
</span><span class='line'>          <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>The data is about countries. The <code>region</code> column describes the region that country belongs to. A region can have more than one country.</p>

<p>This a ideal place where we can use Categorical Index if we want to study about different regions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">CategoricalIndex</span><span class="o">.</span><span class="n">new</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">vector</span><span class="o">[</span><span class="s1">&#39;Region&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#&lt;Daru::CategoricalIndex(194): {Eastern Mediterranean, Europe, Africa, Europe, Africa, Americas, Americas, Europe, Western Pacific, Europe, Europe, Americas, Eastern Mediterranean, South-East Asia, Americas, Europe, Europe, Americas, Africa, South-East Asia ... Africa}&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see all regions there are:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">cat</span>
</span><span class='line'>  <span class="o">[</span><span class="s2">&quot;Eastern Mediterranean&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe&quot;</span><span class="p">,</span> <span class="s2">&quot;Africa&quot;</span><span class="p">,</span> <span class="s2">&quot;Americas&quot;</span><span class="p">,</span> <span class="s2">&quot;Western Pacific&quot;</span><span class="p">,</span> <span class="s2">&quot;South-East Asia&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s find out how many countries lie in Africa region.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">[</span><span class="s1">&#39;Africa&#39;</span><span class="o">].</span><span class="n">size</span>
</span><span class='line'>  <span class="mi">46</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finding out the mean life expectancy of europe is as easy as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">[</span><span class="s1">&#39;Europe&#39;</span><span class="o">][</span><span class="s1">&#39;LifeExpectancy&#39;</span><span class="o">].</span><span class="n">mean</span>
</span><span class='line'>  <span class="mi">76</span><span class="o">.</span><span class="mi">73584905660377</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see the maximum life expectancy  of South-East Asia</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">[</span><span class="s1">&#39;South-East Asia&#39;</span><span class="o">][</span><span class="s1">&#39;LifeExpectancy&#39;</span><span class="o">].</span><span class="n">min</span>
</span><span class='line'>  <span class="mi">63</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Internal architecture</h2>

<p>To efficiently store the index and make retrieval possible in constant time, <code>Daru::CategoricalIndex</code> uses two data structres-</p>

<ul>
<li>Hash-table: To map each category to positional values. It is represented as <code>@cat_hash</code>.</li>
<li>Array: To map each position to a integer which represent a category.</li>
</ul>


<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">idx</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">CategoricalIndex</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:C</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>For <code>idx</code>, the hash table and array woul be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@cat_hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">c</span><span class="p">:</span> <span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@array</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Of course, we would need to have a variable to map <code>0</code> to <code>:a</code>, <code>1</code> to <code>:b</code> and <code>2</code> to <code>:c</code>.)</p>

<p>The hash table helps us in retriving all instances which belong to that category in real time.</p>

<p>Similary, the array helps us in retriving category of an instance in constant time.</p>

<p>And the reason to store integers in the array instead of name of categories itself is to avoid unnecessary usage of space.</p>

<h2>When and why to use Categorical Index</h2>

<p>If you have a categorical variable or data where there are more than one instance of same object and you want to index the dataframe by that column.</p>

<p>It will save you a lot of space and make access to the same category fast.</p>

<p>Also if you want your dataframe to be indexed by a column in which not every entry is unique categorical index will come to the rescue.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/07/19/formula-language-week7-8/">Formula Language Implementation [Week 7-8]</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/02/visualization/">Visualization [Week 5-6]</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/21/categorical-data/">Categorical Data [Week 3-4]</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/14/categorical-index/">Categorical Index [Week 1-2]</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Lokesh Sharma -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lokeshhgithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
